---
title: 'Resumptive Relative Clause Dependencies in the Processing of Second Language English'
author: 'Fred Zenker'
documentclass: book
output:
  bookdown::html_document2:
    number_sections: TRUE
    fig_caption: TRUE
mainfont: Times New Roman
---

```{css echo = FALSE}

.header-section-number::after {
  content: '.';
}

```

```{r include = FALSE}

# set global options ...

knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

# load packages ...

library(tidyverse)
library(kableExtra)
library(emmeans)

```

```{r eval = FALSE, include = FALSE}

# load main dataframe ...

df <- read_csv('data/data.csv', col_types = cols(.default = 'c')) %>%
  select(-audio_data)

# load c-test data ...

ct <- read_csv('data/ctest_scored.csv', col_types = cols(.default = 'f', accuracy = 'l'))

# prep proficiency scores ...

proficiency <- ct %>%
  group_by(study, group, participant) %>%
  summarise(proficiency = sum(accuracy, na.rm=T)) %>%
  ungroup()

# prep ept data ...

ep <- df %>%
  filter(task == 'ept') %>%
  arrange(study, group, participant) %>%
  select_if(function(x){!all(is.na(x))})

# prep sprt data ...

spr <- df %>%
  filter(task == 'sprt') %>%
  arrange(study, group, participant) %>%
  select_if(function(x){!all(is.na(x))})

# prep ajt data ...

ajt <- df %>%
  filter(task %in% c('english_ajt', 'korean_ajt', 'mandarin_ajt')) %>%
  arrange(study, group, participant) %>%
  select_if(function(x){!all(is.na(x))})

```

# (APPENDIX) Appendices {-}

# Results Tables from the ORC Study

## Elicited Production Task

### Resumption Rates

```{r echo = FALSE}

model <- read_rds('models/ajt_doall_glmer_md5.rds')

table <- summary(model)$coefficients %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', '*z*' = 'z value', '*p*' = 'Pr(>|z|)') %>%
  mutate_if(is.character, str_replace_all,
            c('environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(KLE)', 'group3' = 'Group(MLE)'))

table %>%
  kable(caption = 'Summary of Logistic Regression Model on Resumption Rates',
        digits = c(2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: Resumption ~ Environment * Group + (1 + Environment | Participant) + (1 | Item). Reference level: Short + ENS. Estimate unit: logit. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

pairs <- pairs(emmeans(model, ~ environment * group), adjust = 'mvt', simple = 'each', combine = TRUE, reverse = TRUE)

table <- pairs %>%
  as.data.frame() %>%
  rename('*p*' = 'p.value', '*z*' = 'z.ratio',
         'Environment' = 'environment', 'Group' = 'group', 
         'Contrast' = 'contrast', 'Estimate' = 'estimate') %>%
  mutate_if(is.character, str_replace_all, 
            c('english' = 'ENS', 'korean' = 'KLE', 'mandarin' = 'MLE',
              'short' = 'Short', 'long' = 'Long', 'island' = 'Island')) %>% 
  select(-df)

table %>%
  kable(caption = 'Pairwise Comparisons for Logistic Regression Model on Resumption Rates',
        digits = c(2, 2, 2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 18 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Estimated marginal means from logistic regression model on resumption rates. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- plot(emmeans(model, ~ environment * group), adjust = 'mvt', by = 'group', combine = TRUE, reverse = TRUE, comparisons = TRUE, plotit = FALSE)

ggplot(plot, aes(x = environment, y = the.emmean, group = group)) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0, lwd = 5, col = '#ffb000', alpha = .5, position = position_dodge(width = .4)) +
  geom_errorbar(aes(ymin = case_when(is.na(lcmpl)~the.emmean, TRUE ~ lcmpl), ymax = case_when(is.na(rcmpl)~the.emmean, TRUE ~ rcmpl)), width = 0, lwd = 1, col = '#ffb000', position = position_dodge(width = .4)) +
  geom_line(lwd = 1, col = '#ffb000', position = position_dodge(width = .4)) +
  geom_point(size = 3, col = '#ffb000', shape = 15, position = position_dodge(width = .4)) +
  theme_classic() +
  scale_y_continuous(name="logits", limits = c(-20, 0)) +
  scale_x_discrete(limits = c('short', 'long', 'island')) +
  theme(text = element_text(size = 12), 
        legend.margin=margin(0, 0, 0, -5)) +
  facet_wrap(~group, labeller = as_labeller(c(`english` = 'ENS', `korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/ept_rate_emmeans.png", width=6.5, height=2, dpi=600)

```

### Proficiency Effects

```{r echo = FALSE}

model <- read_rds('models/ept_orc_glmer_md2.rds')

table <- summary(model)$coefficients %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', '*z*' = 'z value', '*p*' = 'Pr(>|z|)') %>%
  mutate_if(is.character, str_replace_all,
            c('environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(MLE)',
              'proficiency' = 'Proficiency'))

table %>%
  kable(caption = 'Summary of Logistic Regression Model for Proficiency Effects on Resumption Rates',
        digits = c(2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: Resumption ~ Environment * Group + (1 + Environment | Participant) + (1 | Item). Reference level: Short + KLE. Estimate unit: logit. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

trends <- emtrends(model, ~ environment * group, var = 'proficiency', adjust = 'mvt')
test <- test(trends)

table <- test %>%
  as.data.frame() %>%
  rename('Group' = 'group', 'Environment' = 'environment', 'Estimate' = 'proficiency.trend', '*z*' = 'z.ratio', '*p*' = 'p.value') %>%
  mutate(Group = recode(Group, korean = 'KLE', mandarin = 'MLE'),
         Environment = recode(Environment, short = 'Short', long = 'Long', island = 'Island')) %>%
  select(-df)

table %>%
  kable(caption = 'Post-Hoc Tests from Logistic Regression Model for Proficiency Effects on Resumption Rates',
        digits = c(2, 2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 6 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Relationship between resumption rates and proficiency scores from post-hoc tests. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- emmip(model, environment ~ proficiency | group, cov.reduce = range, CIs = TRUE, plotit = FALSE)

ggplot(plot, aes(x = xvar, y = yvar, group = environment, col = environment, linetype = environment)) +
  theme_classic() +
  geom_ribbon(aes(ymin = LCL, ymax = UCL, fill = environment), alpha = .1, col = NA) +
  geom_line(lwd = .75) +
  scale_y_continuous(name='logits') +
  scale_x_continuous(name='mean-centered proficiency score') +
  scale_linetype_manual(values = c('longdash', 'solid', 'twodash')) +
  scale_color_manual(values = c('#619CFF', '#00BA38', '#F8766D')) +
  scale_fill_manual(values = c('#619CFF', '#00BA38', '#F8766D')) +
  theme(legend.key.size = unit(2,"line")) +
  facet_wrap(~group, labeller = as_labeller(c(`korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/ept_resumption_proficiency_emmeans.png", width=6.5, height=2, dpi=600)

```

### Resumption Subtypes

```{r echo = FALSE}

model <- read_rds('models/ept_orc_resumption_type_glmmtmb_model2.rds')

md <- read_rds('models/ept_orc_resumptoin_type_glmmtmb_data.rds')

table <- summary(model)$coefficients$cond %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', 'z' = 'z value', 'p' = 'Pr(>|z|)') %>%
  mutate_at(vars('p'), round, 3) %>%
  mutate_at(vars('Estimate', 'SE', 'z'), round, 2) %>%
  mutate_if(is.character, str_replace_all, 
            c('subtype2' = 'Subtype(Full NP)',
              'environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(KLE)', 'group3' = 'Group(MLE)')) %>%
  rename('*p*' = 'p', '*z*' = 'z')

table %>%
  kable(caption = 'Summary of Negative Binomial Regression Model on Resumption Subtypes', 
        escape = FALSE,
        digits = c(2, 2, 2, 2, 3)) %>% 
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: Count ~ Subtype * Environment * Group + (1 + Environment | Participant). Reference level: Pronoun + Long + ENS. Estimate unit: log count. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

pairs <- pairs(emmeans(model, ~ subtype * environment * group), adjust = 'mvt', simple = 'each', combine = TRUE, reverse = TRUE)

table <- pairs %>%
  as.data.frame() %>%
  rename('*p*' = 'p.value', '*t*' = 't.ratio',
         'Environment' = 'environment', 'Group' = 'group', 'Subtype' = 'subtype', 
         'Contrast' = 'contrast', 'Estimate' = 'estimate') %>%
  mutate_if(is.character, str_replace_all, 
            c('english' = 'ENS', 'korean' = 'KLE', 'mandarin' = 'MLE',
              'short' = 'Short', 'long' = 'Long', 'island' = 'Island', 
              'pronoun' = 'Pronoun', 'fullNP' = 'Full NP'))

table %>%
  kable(caption = 'Pairwise Comparisons for Binomial Regression Model on Resumption Subtypes',
      digits = c(2, 2, 2, 2, 2, 2, 2, 2, 3)) %>% 
  kable_classic(bootstrap_options = c('condensed')) %>%
  remove_column(7) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 24 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Estimated marginal means from negative binomial regression model on resumption subtypes. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- plot(emmeans(model, ~ subtype * environment * group), combine = TRUE, comparisons = TRUE, adjust = 'mvt', plotit = FALSE)

ggplot(plot, aes(x = environment, y = the.emmean, group = subtype, col = subtype, shape = subtype)) +
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width = 0, lwd = 5, alpha = .5, position = position_dodge(width = .4)) +
  geom_errorbar(aes(ymin = case_when(is.na(lcmpl)~the.emmean, TRUE ~ lcmpl), ymax = case_when(is.na(rcmpl)~the.emmean, TRUE ~ rcmpl)), width = 0, lwd = 1, position = position_dodge(width = .4)) +
  geom_line(lwd = 1, position = position_dodge(width = .4)) +
  geom_point(size = 3, position = position_dodge(width = .4)) +
  theme_classic() +
  scale_y_continuous(name="log count") +
  scale_colour_manual(name='subtype', 
                      values=c('#ffb000', 'darkorange'),
                      breaks = c('pronoun', 'fullNP'),
                      labels = c('pronoun', 'full NP')) +
  scale_shape_manual(name='subtype', 
                     values=c(15, 17),
                     breaks = c('pronoun', 'fullNP'),
                     labels = c('pronoun', 'full NP')) +
  theme(text = element_text(size = 12), 
        legend.margin=margin(0, 0, 0, -5)) +
  facet_wrap(~group, labeller = as_labeller(c(`english` = 'ENS', `korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/ept_resumption_type_count_emmeans.png", width=6.5, height=2, dpi=600)

```

### Resumption Use

```{r echo = FALSE}

model <- read_rds('models/ept_coverage_glmer_model1.rds')

table <- summary(model)$coefficients %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', '*z*' = 'z value', '*p*' = 'Pr(>|z|)') %>%
  mutate_if(is.character, str_replace_all, 
            c('environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(KLE)', 'group3' = 'Group(MLE)'))

check <- table %>% 
  mutate(OR = round(exp(abs(Estimate)), 2))

table %>%
  kable(caption = 'Summary of Logistic Regression Model on Resumption Use',
        digits = c(2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: Use ~ Environment * Group + (1 | Participant). Reference level: Short + ENS. Estimate unit: logit. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

pairs <- pairs(emmeans(model, ~ environment * group), adjust = 'mvt', simple = 'each', combine = TRUE, reverse = TRUE)

# eff_size(pairs, sigma = sigma(model), edf = df.residual(model), method = 'identity')

table <- pairs %>%
  as.data.frame() %>%
  rename('*p*' = 'p.value', '*z*' = 'z.ratio',
         'Environment' = 'environment', 'Group' = 'group',
         'Contrast' = 'contrast', 'Estimate' = 'estimate') %>%
  mutate_if(is.character, str_replace_all, 
            c('english' = 'ENS', 'korean' = 'KLE', 'mandarin' = 'MLE',
              'short' = 'Short', 'long' = 'Long', 'island' = 'Island')) %>%
  select(-df)

check <- table %>%
  mutate(OR = round(exp(abs(Estimate)), 2))

table %>%
  kable(caption = 'Pairwise Comparisons for Logistic Regression Model on Resumption Use',
        digits = c(2, 2, 2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 18 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Estimated marginal means from logistic regression model on resumption use. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- plot(emmeans(model, ~ environment | group), combine = TRUE, comparisons = TRUE, adjust = 'mvt', plotit = FALSE)

ggplot(plot, aes(x = environment, y = the.emmean, group = group)) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0, lwd = 5, col = '#ffb000', alpha = .5, position = position_dodge(width = .4)) +
  geom_errorbar(aes(ymin = case_when(is.na(lcmpl)~the.emmean, TRUE ~ lcmpl), ymax = case_when(is.na(rcmpl)~the.emmean, TRUE ~ rcmpl)), width = 0, lwd = 1, col = '#ffb000', position = position_dodge(width = .4)) +
  geom_line(lwd = 1, col = '#ffb000', position = position_dodge(width = .4)) +
  geom_point(size = 3, col = '#ffb000', shape = 15, position = position_dodge(width = .4)) +
  theme_classic() +
  scale_y_continuous(name='logits') +
  scale_x_discrete(limits = c('short', 'long', 'island')) +
  theme(text = element_text(size = 12), 
        legend.margin=margin(0, 0, 0, -5)) +
  facet_wrap(~group, labeller = as_labeller(c(`english` = 'ENS', `korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/ept_coverage_emmeans.png", width=6.5, height=2, dpi=600)

```

## Self-Paced Reading Task

### RRTs at Region 1

```{r echo = FALSE}

data <- read_rds('data/spr_rrt_md.rds')

model <- read_rds('models/spr_doall_rrt_region1_md6.rds')

table <- summary(model)$coefficients %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', '*t*' = 't value', '*p*' = 'Pr(>|t|)') %>%
  mutate_if(is.character, str_replace_all,
            c('dependency2' = 'Dependency(RP)', 
              'environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(KLE)', 'group3' = 'Group(MLE)')) %>%
  select(-df)

# library(EMAtools)
# check <- lme.dscore(model, data = filter(data, study == '210510_do', region2 == '1'), type = 'lme4')

table %>%
  kable(caption = 'Summary of Linear Regression Model for RRTs at Region 1',
        digits = c(2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: RRT ~ Dependency * Environment * Group + (1 + Dependency | Participant) + (1 + Dependency + Group | Item). Reference level: Gap + Short + ENS. Estimate unit: millisecond. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

pairs <- pairs(emmeans(model, ~ dependency * environment * group), adjust = 'mvt', simple = 'each', combine = TRUE, reverse = TRUE)

table <- pairs %>%
  as.data.frame() %>%
  rename('*p*' = 'p.value', '*z*' = 'z.ratio',
         'Dependency' = 'dependency', 'Environment' = 'environment', 'Group' = 'group',
         'Contrast' = 'contrast', 'Estimate' = 'estimate') %>%
  mutate_if(is.character, str_replace_all, 
            c('english' = 'ENS', 'korean' = 'KLE', 'mandarin' = 'MLE',
              'gap' = 'Gap', 'pronoun' = 'RP',
              'short' = 'Short', 'long' = 'Long', 'island' = 'Island')) %>%
  select(-df)

table %>%
  kable(caption = 'Pairwise Comparisons for Linear Regression Model for RRTs at Region 1',
        digits = c(2, 2, 2, 2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 45 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Estimated marginal means from linear regression model for RRTs at Region 1. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- plot(emmeans(model, ~ dependency * environment * group), comparisons = TRUE, adjust = 'mvt', plotit = FALSE)

ggplot(plot, aes(x = environment, y = the.emmean, group = dependency, col = dependency, shape = dependency)) +
  geom_hline(yintercept = 0) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0, lwd = 5, alpha = .5, position = position_dodge(width = .4)) +
  geom_errorbar(aes(ymin = case_when(is.na(lcmpl)~the.emmean, TRUE ~ lcmpl), ymax = case_when(is.na(rcmpl)~the.emmean, TRUE ~ rcmpl)), width = 0, lwd = 1, position = position_dodge(width = .4)) +
  geom_line(lwd = 1, position = position_dodge(width = .4)) +
  geom_point(size = 3, position = position_dodge(width = .4)) +
  theme_classic() +
  scale_y_continuous(name="RRT (ms)", breaks = seq(-100, 75, by = 25), limits = c(-110, 85)) +
  scale_colour_manual(name="dependency", values=c('#648fff', '#ffb000'), labels=c("gap", "resumption")) +
  scale_shape_manual(name="dependency", values=c(16, 15), labels=c("gap", "resumption")) +
  theme(text = element_text(size = 12), 
        legend.margin=margin(0, 0, 0, -5)) +
  facet_wrap(~group, labeller = as_labeller(c(`english` = 'ENS', `korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/spr_rrt_region1_emmeans.png", width=6.5, height=2, dpi=600)

```

### RRTs at Region 2

```{r echo = FALSE}

model <- read_rds('models/spr_doall_rrt_region2_md9.rds')

table <- summary(model)$coefficients %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', '*t*' = 't value', '*p*' = 'Pr(>|t|)') %>%
  mutate_if(is.character, str_replace_all,
            c('dependency2' = 'Dependency(RP)', 
              'environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(KLE)', 'group3' = 'Group(MLE)')) %>%
  select(-df)

# library(EMAtools)
# check <- lme.dscore(model, data = filter(data, study == '210510_do', region2 == '1'), type = 'lme4')

table %>%
  kable(caption = 'Summary of Linear Regression Model for RRTs at Region 2',
        digits = c(2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: RRT ~ Dependency * Environment * Group + (1 + Dependency * Environment | Participant) + (1 + Dependency + Group | Item). Reference level: Gap + Short + ENS. Estimate unit: millisecond. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

pairs <- pairs(emmeans(model, ~ dependency * environment * group), adjust = 'mvt', simple = 'each', combine = TRUE, reverse = TRUE)

table <- pairs %>%
  as.data.frame() %>%
  rename('*p*' = 'p.value', '*z*' = 'z.ratio',
         'Dependency' = 'dependency', 'Environment' = 'environment', 'Group' = 'group',
         'Contrast' = 'contrast', 'Estimate' = 'estimate') %>%
  mutate_if(is.character, str_replace_all, 
            c('english' = 'ENS', 'korean' = 'KLE', 'mandarin' = 'MLE',
              'gap' = 'Gap', 'pronoun' = 'RP',
              'short' = 'Short', 'long' = 'Long', 'island' = 'Island')) %>%
  select(-df)

table %>%
  kable(caption = 'Pairwise Comparisons for Linear Regression Model for RRTs at Region 2',
        digits = c(2, 2, 2, 2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 45 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Estimated marginal means from linear regression model for RRTs at Region 2. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- plot(emmeans(model, ~ dependency * environment * group), comparisons = TRUE, adjust = 'mvt', plotit = FALSE)

ggplot(plot, aes(x = environment, y = the.emmean, group = dependency, col = dependency, shape = dependency)) +
  geom_hline(yintercept = 0) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0, lwd = 5, alpha = .5, position = position_dodge(width = .4)) +
  geom_errorbar(aes(ymin = case_when(is.na(lcmpl)~the.emmean, TRUE ~ lcmpl), ymax = case_when(is.na(rcmpl)~the.emmean, TRUE ~ rcmpl)), width = 0, lwd = 1, position = position_dodge(width = .4)) +
  geom_line(lwd = 1, position = position_dodge(width = .4)) +
  geom_point(size = 3, position = position_dodge(width = .4)) +
  theme_classic() +
  scale_y_continuous(name="RRT (ms)", breaks = seq(-100, 75, by = 25), limits = c(-110, 85)) +
  scale_colour_manual(name="dependency", values=c('#648fff', '#ffb000'), labels=c("gap", "resumption")) +
  scale_shape_manual(name="dependency", values=c(16, 15), labels=c("gap", "resumption")) +
  theme(text = element_text(size = 12), 
        legend.margin=margin(0, 0, 0, -5)) +
  facet_wrap(~group, labeller = as_labeller(c(`english` = 'ENS', `korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/spr_rrt_region2_emmeans.png", width=6.5, height=2, dpi=600)

```

### RRTs at Region 3

```{r echo = FALSE}

model <- read_rds('models/spr_doall_rrt_region3_md6.rds')

table <- summary(model)$coefficients %>%
  as.data.frame() %>%
  rownames_to_column('Parameter') %>%
  rename('SE' = 'Std. Error', '*t*' = 't value', '*p*' = 'Pr(>|t|)') %>%
  mutate_if(is.character, str_replace_all,
            c('dependency2' = 'Dependency(RP)', 
              'environment2' = 'Environment(Long)', 'environment3' = 'Environment(Island)',
              'group2' = 'Group(KLE)', 'group3' = 'Group(MLE)')) %>%
  select(-df)

# library(EMAtools)
# check <- lme.dscore(model, data = filter(data, study == '210510_do', region2 == '1'), type = 'lme4')

table %>%
  kable(caption = 'Summary of Linear Regression Model for RRTs at Region 3',
        digits = c(2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: RRT ~ Dependency * Environment * Group + (1 | Participant) + (1 + Group | Item). Reference level: Gap + Short + ENS. Estimate unit: millisecond. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE}

pairs <- pairs(emmeans(model, ~ dependency * environment * group), adjust = 'mvt', simple = 'each', combine = TRUE, reverse = TRUE)

table <- pairs %>%
  as.data.frame() %>%
  rename('*p*' = 'p.value', '*z*' = 'z.ratio',
         'Dependency' = 'dependency', 'Environment' = 'environment', 'Group' = 'group',
         'Contrast' = 'contrast', 'Estimate' = 'estimate') %>%
  mutate_if(is.character, str_replace_all, 
            c('english' = 'ENS', 'korean' = 'KLE', 'mandarin' = 'MLE',
              'gap' = 'Gap', 'pronoun' = 'RP',
              'short' = 'Short', 'long' = 'Long', 'island' = 'Island')) %>%
  select(-df)

table %>%
  kable(caption = 'Pairwise Comparisons for Linear Regression Model for RRTs at Region 3',
        digits = c(2, 2, 2, 2, 2, 2, 2, 3)
        ) %>%
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t* method for 45 tests.',
           footnote_as_chunk = TRUE)

```

```{r echo = FALSE, fig.with = 6.5, fig.height = 2, fig.cap = 'Estimated marginal means from linear regression model for RRTs at Region 3. Transparent bars are 95% confidence intervals; solid bars are comparison bars from post-hoc tests.'}

plot <- plot(emmeans(model, ~ dependency * environment * group), comparisons = TRUE, adjust = 'mvt', plotit = FALSE)

ggplot(plot, aes(x = environment, y = the.emmean, group = dependency, col = dependency, shape = dependency)) +
  geom_hline(yintercept = 0) +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0, lwd = 5, alpha = .5, position = position_dodge(width = .4)) +
  geom_errorbar(aes(ymin = case_when(is.na(lcmpl)~the.emmean, TRUE ~ lcmpl), ymax = case_when(is.na(rcmpl)~the.emmean, TRUE ~ rcmpl)), width = 0, lwd = 1, position = position_dodge(width = .4)) +
  geom_line(lwd = 1, position = position_dodge(width = .4)) +
  geom_point(size = 3, position = position_dodge(width = .4)) +
  theme_classic() +
  scale_y_continuous(name="RRT (ms)", breaks = seq(-100, 75, by = 25), limits = c(-110, 85)) +
  scale_colour_manual(name="dependency", values=c('#648fff', '#ffb000'), labels=c("gap", "resumption")) +
  scale_shape_manual(name="dependency", values=c(16, 15), labels=c("gap", "resumption")) +
  theme(text = element_text(size = 12), 
        legend.margin=margin(0, 0, 0, -5)) +
  facet_wrap(~group, labeller = as_labeller(c(`english` = 'ENS', `korean` = 'KLE', `mandarin` = 'MLE')))

# ggsave("plots/orc/spr_rrt_region2_emmeans.png", width=6.5, height=2, dpi=600)

```

### Proficiency Effects for RRTs at Region 2

### Comprehension Question Accuracy

### Proficiency Effects for Comprehension Question Accuracy

## Acceptability Judgment Task

# Results Tables from the SRC Study

## C-Test

## Elicited Production Task

## Self-Paced Reading Task

## Acceptability Judgment Task

# Chopping Block

```{r eval = FALSE, include = FALSE}

table <- read_rds('tables/ept_orc_glmmtmb_primary.rds')

kable(table, caption = 'Summary of Negative Binomial Regression Model on Count Data') %>% 
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = 'Model formula: Count ~ Dependency * Environment * Group + (1 | Participant). Reference level: Gap + Short + ENS. Estimate unit: log count. Intercept: grand mean.',
           footnote_as_chunk = TRUE)

```

```{r eval = FALSE, include = FALSE}

table <- read_rds('tables/ept_orc_glmmtmb_pairwise.rds')

kable(table, caption = 'Pairwise Comparisons for Binomial Regression Model on Count Data') %>% 
  kable_classic(bootstrap_options = c('condensed')) %>%
  footnote(general = '*P*-value adjustment: multivariate *t*.',
           footnote_as_chunk = TRUE)

```

```{r eval = FALSE, include = FALSE, out.width="75%", fig.cap="English Version of the Language Background Questionnaire"}
knitr::include_graphics('images/lbq.png')
```

